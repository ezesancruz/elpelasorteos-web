# El Pela Sorteos Web

Landing page and admin tooling for the El Pela Sorteos sweepstakes campaign.

## Highlights
- Single-page application that renders dynamic content from `data/site-content.json`.
- Built-in visual editor with live preview and content persistence via a lightweight Express server.
- Image uploader that stores assets under `server/public/uploads/` and rewrites URLs automatically.
- Ready to deploy as a static site (Netlify, Vercel, GitHub Pages) or behind the bundled Node.js server.

## Requirements
- Node.js 18+
- npm 9+ (comes with recent Node.js releases)
- Modern browser (Chrome, Edge, Firefox)

## Quick start
```bash
npm install
npm run dev
```
The command above starts the Express server on `http://localhost:5173`, serves the SPA, exposes the `/api/content` endpoint to persist JSON edits, and `/api/upload` to handle image uploads.

Stop the server at any time with `Ctrl + C`.

## Project layout
```
web/
├── data/                  # Editable content (site-content.json)
├── ganadoresanteriores/   # Pre-rendered "Ganadores" page
├── scripts/               # Front-end logic and visual editor
├── server/                # Express server (content + uploads API)
├── sorteo/                # Shortcut to the main landing page
├── styles/                # Global styles (main.css)
├── index.html             # Entry point served by the SPA
├── package.json           # Dependencies and npm scripts
└── README*.md, LICENCE    # Documentation and licensing
```

## Editing content
### Visual editor (recommended)
1. Open `http://localhost:5173`.
2. Click the floating `?` button to open the editor panel.
3. Switch between the "Sorteo" and "Ganadores" pages, update hero copy, manage sections, and change theming.
4. Use **Save changes** to persist directly to `data/site-content.json` (server must be running) or **Download JSON** to export the content manually.
5. Uploading images from the editor stores them under `server/public/uploads/` and returns a relative URL you can reuse in the JSON.

### Manual edit
1. Open `data/site-content.json` in your editor of choice.
2. Update the relevant `pages[]` entries. Section types include `richText`, `linkCards`, `imageGrid`, `imageCarousel`, `imageHighlight`, `cta`, and `winnerCards`.
3. Validate the file (for example with https://jsonlint.com) before saving to avoid broken builds.

## Deploying
- **Static hosting**: For static hosting (Netlify, Vercel, GitHub Pages, S3, etc.), simply upload the contents of the `web` folder without the `server/` directory. The site functions as a SPA.
- **Dynamic hosting**: If runtime saving is required in production, deploy the Express server to your chosen infrastructure and expose the `/api/content` and `/api/upload` routes (HTTPS recommended).
- Backup `data/site-content.json` regularly and keep `server/public/uploads/` outside of version control (see `.gitignore`).

## Deploying with Docker
This project includes a `Dockerfile` and `docker-compose.yml` to make it easy to build and run the application in a container.

### Building the image
To build the Docker image, run the following command in the `web` directory:
```bash
docker build -t elpelasorteos-web .
```

### Running the container
You can run the container using `docker run` or `docker-compose`.

#### Using `docker run`
```bash
docker run -p 8080:8080 -d --name elpelasorteos-web elpelasorteos-web
```

#### Using `docker-compose`
The `docker-compose.yml` file is configured to run the application and a Caddy server as a reverse proxy.
To start the application, run the following command in the `web` directory:
```bash
docker-compose up -d
```
This will start the web application on port 8080 and the Caddy server on ports 80 and 443.

## Pre-render (optional, SEO-friendly)
Create static HTML snapshots for key routes without dynamic scripts.

```bash
npm run prerender
```

- Outputs `dist/` snapshots for `/` and `/ganadoresanteriores/`.
- Strips `<script src="scripts/app.js">` and `scripts/editor.js` from snapshots to make them fully static.
- Useful for static hosting (upload `dist/` as your site root) or CI/CD pre-rendering.

## Related docs
- `README_es.md`: localized quick start in Spanish.
- `INSTRUCTIVO.txt`: extended operator manual for editors and stakeholders.
- `LICENCE`: licensing terms (MIT).

## Troubleshooting
- **"Save changes" button fails**: confirm `npm run dev` is active and the JSON is valid.
- **New images are not visible**: verify the upload finished without error and the file exists in `server/public/uploads/`.
- **Site shows a blank screen**: open the browser console (F12 -> Console) and check for JSON errors or non-existent paths.
- **Permission error when saving**: check that the `data/` folder has write permissions.

## License
Distributed under the MIT License. See `LICENCE` for full details.
